import{a as M,S as y,L as I}from"./axios-ClFV7AQa.js";import{h as T}from"./moment-Cl4UOzQZ.js";import{r as v,x as U,l as N,o as n,c as d,a as e,m as f,v as k,t as c,k as E,F as $,n as C,q as B,d as L,y as z,p as P,f as R,h as q,b as S,u as A,j as J}from"./index-FZ_suL2I.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as j}from"./PaginationComponent-CIWciu2r.js";const p=m=>(P("data-v-c80fa4b0"),m=m(),R(),m),F={method:"dialog"},H={class:"bg-#212529 flex justify-between items-center p-4"},G=p(()=>e("h3",{class:"text-white"},"修改訂單",-1)),K={class:"grid grid-cols-2 gap-6 p-3"},Q={key:0},W=p(()=>e("h4",{class:"text-center font-size-6 mb-2"},"客戶資料",-1)),X={class:"input-group"},Z=p(()=>e("label",{for:"name"},"姓名",-1)),ee={class:"input-group"},te=p(()=>e("label",{for:"tel"},"電話",-1)),oe={class:"input-group"},se=p(()=>e("label",{for:"email"},"Email",-1)),le={class:"input-group"},re=p(()=>e("label",{for:"address"},"地址",-1)),ae=p(()=>e("h4",null,"留言：",-1)),ne={class:"flex flex-col"},de=p(()=>e("h4",{class:"text-center font-size-6"},"購買的商品",-1)),ie=p(()=>e("thead",null,[e("tr",null,[e("th",{class:"font-size-5"},"商品名稱"),e("th",{class:"font-size-5"},"數量")])],-1)),ue={class:"text-center font-size-4.5"},ce={class:"input-group"},pe=["onUpdate:modelValue","onChange"],_e={class:"text-end col-start-2"},he={for:"is_paid",class:"me-2"},ve={class:"text-end p-3 border-t border-solid border-#dee2e6"},me={__name:"OrderModal",props:["tempOrder"],setup(m,{expose:b}){const _=m,t=v(_.tempOrder),h=v(),O=U(()=>JSON.stringify(_.tempOrder)==JSON.stringify(t.value));function g(r){r.target.nodeName==="DIALOG"&&h.value.close()}function x(r){t.value.products[r.id].final_total=t.value.products[r.id].qty*t.value.products[r.id].product.price,t.value.products[r.id].total=t.value.products[r.id].final_total}return N(()=>_.tempOrder,()=>{t.value=JSON.parse(JSON.stringify(_.tempOrder))}),b({dialog:h}),(r,s)=>(n(),d("dialog",{ref_key:"dialog",ref:h,class:"max-w-1140px w-100% border-0 rd p-0 backdrop:backdrop-blur-3",onClick:g},[e("form",F,[e("div",H,[G,e("button",{type:"button",class:"i-ic:baseline-close p-2 text-white font-size-4 hover:cursor-pointer",onClick:s[0]||(s[0]=o=>h.value.close())})]),e("div",K,[t.value.user?(n(),d("div",Q,[W,e("div",X,[Z,f(e("input",{type:"text",id:"name",placeholder:"請輸入標題","onUpdate:modelValue":s[1]||(s[1]=o=>t.value.user.name=o)},null,512),[[k,t.value.user.name]])]),e("div",ee,[te,f(e("input",{type:"tel",id:"tel",placeholder:"請輸入標題","onUpdate:modelValue":s[2]||(s[2]=o=>t.value.user.tel=o)},null,512),[[k,t.value.user.tel]])]),e("div",oe,[se,f(e("input",{type:"email",id:"email",placeholder:"請輸入標題","onUpdate:modelValue":s[3]||(s[3]=o=>t.value.user.email=o)},null,512),[[k,t.value.user.email]])]),e("div",le,[re,f(e("input",{type:"address",id:"address",placeholder:"請輸入標題","onUpdate:modelValue":s[4]||(s[4]=o=>t.value.user.address=o)},null,512),[[k,t.value.user.address]])]),e("div",null,[ae,e("p",null,c(t.value.message),1)])])):E("",!0),e("div",ne,[de,e("table",null,[ie,e("tbody",null,[(n(!0),d($,null,C(t.value.products,o=>(n(),d("tr",{key:o.id},[e("td",ue,c(o.product.title),1),e("td",null,[e("div",ce,[f(e("input",{type:"number",min:"1","onUpdate:modelValue":w=>o.qty=w,onChange:w=>x(o)},null,40,pe),[[k,o.qty,void 0,{number:!0}]])])])]))),128))])])]),e("div",_e,[e("label",he,[f(e("input",{type:"checkbox",id:"is_paid","onUpdate:modelValue":s[5]||(s[5]=o=>t.value.is_paid=o),class:"custom-checkbox"},null,512),[[B,t.value.is_paid]]),L(" 是否付款 ")])])]),e("div",ve,[e("button",{type:"button",class:"m-1 px-3 py-1.5 bg-transparent text-#6c757d border-1 border-solid border-#6c757d rd hover:cursor-pointer hover:bg-#5c636a hover:text-white",onClick:s[6]||(s[6]=o=>h.value.close())},"取消"),e("button",{type:"button",class:z(["m-1 px-3 py-1.5 text-white bg-#0d6efd border-0 rd hover:cursor-pointer hover:bg-#0b5ed7",{disabled:O.value}]),onClick:s[7]||(s[7]=o=>r.$emit("confirmOrder",t.value))},"修改訂單",2)])])],512))}},fe=Y(me,[["__scopeId","data-v-c80fa4b0"]]);var be={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/vue2023-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ge={class:"container mx-a relative"},xe={class:"w-100% mt-6"},ye=e("thead",{class:"border-b-1 border-black border-solid fw-bold text-left"},[e("tr",null,[e("th",{width:"120"}," 下單時間 "),e("th",null,"ID"),e("th",null," 購買品項 "),e("th",null," 使用者資訊 "),e("th",null," 留言 "),e("th",{class:"text-center"}," 訂單總額 "),e("th",{width:"100",class:"text-center"}," 是否付款 "),e("th",{width:"120"}," 編輯 ")])],-1),ke={class:"text-center"},$e={class:"text-center"},Oe={key:0,class:"text-green"},we={key:1,class:"text-red"},Ce={class:"btn-group"},Ve=["onClick"],Me=["onClick"],Ue={__name:"AdminOrders",setup(m){const{VITE_URL:b,VITE_PATH:_}=be,t=v([]),h=v({}),O=v({}),g=v(),x=v(!1);function r(i=1){x.value=!0,M.get(`${b}/v2/api/${_}/admin/orders?page=${i}`).then(u=>{t.value=u.data.orders,h.value=u.data.pagination}).catch(u=>{y.fire({icon:"error",title:"錯誤發生",text:u.response.data.message})}).finally(()=>{x.value=!1})}function s(i){O.value=i,g.value.dialog.showModal()}function o(i){y.fire({icon:"warning",title:"刪除訂單",text:`你確定要刪除 ${i} 這筆訂單嗎?`,showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定"}).then(u=>{u.isConfirmed&&M.delete(`${b}/v2/api/${_}/admin/order/${i}`).then(l=>{y.fire({icon:"success",title:`${l.data.message}`,didClose:()=>{r()}})}).catch(()=>{y.fire("錯誤發生","","error")})})}function w(i){const u=i;let l=0;l=Object.keys(u.products).reduce((a,V)=>a+u.products[V].final_total,0),u.total=l,M.put(`${b}/v2/api/${_}/admin/order/${i.id}`,{data:u}).then(a=>{g.value.dialog.close(),y.fire({icon:"success",title:`${a.data.message}`,didClose:()=>{r()}})}).catch(a=>{console.log(a)})}function D(i){return T(i).format("YYYY-MM-DD")}return q(()=>{r()}),(i,u)=>(n(),d($,null,[e("div",ge,[S(A(I),{active:x.value,"full-page":!1},null,8,["active"]),e("table",xe,[ye,e("tbody",null,[(n(!0),d($,null,C(t.value,l=>(n(),d("tr",{class:"border-b border-#DEE2E6 border-solid",key:l.id},[e("td",null,c(D(l.create_at*1e3)),1),e("td",null,c(l.id),1),e("td",null,[e("ul",null,[(n(!0),d($,null,C(l.products,a=>(n(),d("li",{key:a.id},c(a.product.title)+" x "+c(a.qty),1))),128))])]),e("td",null,[e("ul",null,[(n(!0),d($,null,C(l.user,(a,V)=>(n(),d("li",{key:a},c(V)+" : "+c(a),1))),128))])]),e("td",null,c(l.message),1),e("td",ke,c(l.total),1),e("td",$e,[l.is_paid?(n(),d("span",Oe,"已付款")):(n(),d("span",we,"尚未付款"))]),e("td",null,[e("div",Ce,[e("button",{type:"button",class:"text-#0d6efd bg-transparent border-1 border-#0d6efd border-solid border-r-0 rd-tl rd-bl px-2 py-1 hover:bg-#0d6efd hover:text-white hover:cursor-pointer",onClick:a=>s(l)}," 編輯 ",8,Ve),e("button",{type:"button",class:"text-#dc3545 bg-transparent border-1 border-#de3545 border-solid rd-tr rd-br px-2 py-1 hover:bg-#de3545 hover:text-white hover:cursor-pointer",onClick:a=>o(l.id)}," 刪除 ",8,Me)])])]))),128))])])]),t.value.length?(n(),J(j,{key:0,pages:h.value,onChangePage:r},null,8,["pages"])):E("",!0),S(fe,{"temp-order":O.value,ref_key:"orderModalRef",ref:g,onConfirmOrder:w},null,8,["temp-order"])],64))}};export{Ue as default};
